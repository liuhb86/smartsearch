<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="content-type">
<title>BiLSearch</title>
<script src="http://code.jquery.com/jquery-1.8.3.min.js" type="text/javascript">
</script>
<script src="jquery.query-2.1.7.min.js"></script>
<style>
body, div {
	overflow: hidden;
	margin: 0;
	padding: 0;
}
#resultFrame {
	width: 100%;
	border: none;
	margin: 0;
	padding: 0;
}
#searchBar {
	padding: 5px;
	width : 100%;
	position: absolute;
	background-color: rgba(50,50,50,.5);
}
</style>
</head>
<body>
	<div id="searchBar">
		<input type="text" id="queryInput"></input>
		<button id="searchButton">Search</button>
		<span id="searchEngines">
		</span>
	</div>
	<iframe id="resultFrame">
	</iframe>
</body>
<script type="text/javascript">

(function() {
var self = window.smartSearch = {
	config : {
	},
	runtime : {
	},
	searchEngines : {
		baidu : {
			title : "Baidu",
			url : "http://www.baidu.com/s?ie=utf-8&wd="
		},
		bing : {
			icon : "",
			title : "Bing",
			url : "http://www.bing.com/search?q="
		},
		google : {
			title : "Google",
			url : "http://www.google.com/custom?ie=utf-8&q="		//Ref to baigoogledu.com for XFrame wor
		}
	},
	util : {
		getDomainFromUrl : function (url){
			var match = url && url.match(/:\/\/([^\/]*)/);
			if (match) {
				console.log(match[1]);
				return match[1];
			} else {
				return null;
			}
		},
		getIcon : function (engine) {
			if (engine.icon && engine.icon.length) return engine.icon;
			return "http://www.google.com/s2/favicons?domain="+self.util.getDomainFromUrl(engine.url);
		}
	},
	doSearch : function (query) {
		var i, strEngine, navUrl,
			isPureAscii = true;		
		for (i = 0; i < query.length; ++i) {
			if (query.charCodeAt(i) > 127) {
				isPureAscii = false;
				break;			
			}
		}
		strEngine = isPureAscii ? "google" : "baidu";
		navUrl = self.searchEngines[strEngine].url + query;
		self.doNavigate(navUrl, query);
	},
	doNavigate : function (url, query) {
		self.controller.setFrameUrl(url);
		self.controller.setTitle(query);
		self.controller.setUrlHash(query);
	},

	init : function () {
		self.controller.init();
		if (self.runtime.query) {
			self.doSearch(self.runtime.query);
		}
	}
}})();
(function () {
var self= smartSearch.controller = {
	model : smartSearch,
	setFrameUrl : function (url) { $("#resultFrame")[0].src = url; },
	setTitle : function (query) { window.title = query + " - BiLSearch"; },
	setUrlHash : function (hash) { window.location.hash = hash; },
	onSearch : function () {
		var query = $("#queryInput").val();
			self.model.doSearch(query);
	},
	onResize : function () {
		$("#resultFrame").height(window.innerHeight);	
	},
	bindEvents : function () {
		$("#searchButton").click(self.onSearch);
		$("#queryInput").keypress(function (event) {
			if	(event.which == 13) {
				self.onSearch();	
			}
		});
		$(window).resize(self.onResize);
	},
	addSearchEngineButtons : function () {
		var strEngine, engine;
		for (strEngine in self.model.searchEngines) {
			engine = self.model.searchEngines[strEngine];
			$("#searchEngines").append("<a><img src='" + self.model.util.getIcon(engine) + "'></img></a>");
		}
	},
	init : function () {
		var query;
		self.onResize();
		self.addSearchEngineButtons();
		self.bindEvents();
		if (window.location.hash && window.location.hash.length > 1) {
			query = window.location.hash.substr(1);
		} else {
			query = $.query.get("q");
		}
		self.model.runtime.query = query;
		$("#queryInput").val(query);
	}
}})();


$(function (){
	smartSearch.init();
});
</script>
</html>
